# AUDIT_CHECKLIST — Проєкт «БОТ АРБІТРАЖНИЙ BYBIT»
**Крок 6.3.12 — Audit & Inspection (0 → 6.3.11)**  
Ролі: Senior Dev, QA, PM, DevOps, Repo Maintainer.  
Ціль: виконати повний аудит від нульового кроку до поточного стану (6.3.11), навести лад у репозиторії, перевірити синхронізацію IRM ↔ IRM.view ↔ YAML, прибрати зайве без поломок, і все це — у цільовій гілці з зеленими тестами/гвардами/CI.

---

## 0) Правила виконання аудиту
- Працюємо **у цільовій гілці**: `step-6.3.12-audit` (main не чіпаємо до успішного PR).
- Кожна зміна — **малим комітом з чітким меседжем**.
- Будь-яке вилучення файлів — **спершу у список кандидатів, потім окремий коміт**.
- Після кожного логічного підкроку: `pre-commit run -a` → `pytest -q` →, за потреби, оновлення IRM.

---

## 1) Підготовка середовища (DevOps/Senior Dev)
- [ ] Перейти на main та підтягнути оновлення:
```powershell
git checkout main
git pull --ff-only
git checkout -b step-6.3.12-audit
python --version
pip --version
```
- [ ] Активувати venv (Windows 11):
```powershell
& .\.venv\Scripts\Activate.ps1
pre-commit install
```

---

## 2) Зняття «снімку» поточного стану (Repo Maintainer/PM)
- [ ] Зафіксувати ключові артефакти у лог (для історії PR):
```powershell
git --no-pager log --oneline -n 10
git status
git tag --list
```
- [ ] Перевірити, що **IRM синхронний** (Phase 6.3):
```powershell
python tools/irm_phase6_gen.py --check --phase 6.3
python tools/render_irm_view.py --check
``]
- [ ] Прогнати локальні гварди/тести:
```powershell
pre-commit run -a
pytest -q
```

---

## 3) IRM-рев’ю (PM/Senior Dev)
Мета: звірити дорожню карту, знайти пропуски, скласти «глобальний» трек.
- [ ] Візуально переглянути:
  - `docs/irm.phase6.yaml`
  - `docs/IRM.md`
  - `docs/IRM.view.md`
- [ ] Витягнути список кроків **0 → 6.3.11** і їхній статус (todo/wip/done). *(Якщо у YAML відсутні деякі «ранні» кроки, зафіксувати у «Глобальні пропуски» нижче.)*
- [ ] Переконатися, що **6.3.9 / 6.3.10 / 6.3.11 = done** і відображені у двох IRM.
- [ ] Якщо знайдено розсинхрон: виправити **тільки YAML**, потім згенерувати IRM/IRM.view та повторити гварди/тести.

### Глобальні пропуски (заповнюється вручну за підсумками перегляду)
- [ ] …
- [ ] …

---

## 4) Репозиторна гігієна та «зайве» (Repo Maintainer/DevOps)
Мета: виявити зайві файли/папки/артефакти і зробити план чистки без ризику.

### 4.1 Пошук «сміття» (тільки збираємо, **не видаляємо одразу**)
```powershell
# великі файли (>5 МБ) у відстежених
git ls-files | ForEach-Object { $_, (Get-Item $_).Length } |
  Where-Object { $_[1] -gt 5MB } | Format-Table -AutoSize

# кеші/артефакти у відстежених (підозрілі)
git ls-files | Select-String -Pattern '\.pyc$|__pycache__|\.pytest_cache|\.coverage|\.DS_Store|Thumbs\.db|^dev/|^tmp/|^\.vscode/'

# що ігнорується, але випадково могло потрапити
git check-ignore -v -- * | Sort-Object

# що НЕ ігнорується, але швидше за все має бути ігнорованим
ls -r -fo |
  ? { $_.Name -match '\.log$|\.tmp$|\.bak$|\.swp$|\.old$|\.orig$|^~|^#|\.ipynb_checkpoints' } |
  % FullName
```

### 4.2 Список кандидатів на видалення (заповнюється вручну після огляду)
> **ВАЖЛИВО:** поки лише план. Видалення — окремим комітом після погодження.
- [ ] Папки:
  - [ ] …
- [ ] Файли:
  - [ ] …
- [ ] Ігнор/атрибути (оновити `.gitignore`/`.gitattributes`):
  - [ ] …

---

## 5) Аналіз залежностей та безпеки (Senior Dev/DevOps/QA)
- [ ] Перевірити «хвости» у `requirements.txt`:
```powershell
pip list --format=columns
# (опційно) pipdeptree для дерева залежностей
python -m pip install pipdeptree --quiet
pipdeptree
```
- [ ] Для security-аудиту (опційно — якщо дозволено):  
  - `pip install pip-audit` → `pip-audit`  
  - або `pip install safety` → `safety check`  
- [ ] Зафіксувати знайдені вразливості/застарілі пакети у «Знахідки/рекомендації».

---

## 6) CI/Workflows огляд (DevOps)
- [ ] Перевірити `.github/workflows`:  
  - `irm-check.yml` — працює і потрібен.  
  - `irm_phase6_sync.yml` — актуальний.  
  - `irm-view-check.yml` — є і зелений.  
  - (За потреби) видалити/об’єднати дублікати, застарілі джоби.
- [ ] Перевірити, що **усі джоби зелені** в останніх PR/мерджах.

---

## 7) Гварди та тести (QA/Senior Dev)
- [ ] Прогнати локальні гварди:
```powershell
pre-commit run -a
```
Очікування:  
  - `IRM Phase 6 sync check` — Passed  
  - `Forbid manual commits of docs/IRM.md without YAML` — Passed  
  - `IRM.view must match YAML (render_irm_view.py --check)` — Passed

- [ ] Прогнати тести:
```powershell
pytest -q
```
Очікування: **green**; Coverage ≥ 67% (зараз ~67.8%).

---

## 8) План змін (малими PR, без ризику поломок) — заповнюється за фактом аудиту
- [ ] PR-1: Оновлення `.gitignore`/`.gitattributes`
- [ ] PR-2: Видалення «зайвого» (тільки погоджене з 4.2)
- [ ] PR-3: Документація (README: посилання на IRM.view; коротке пояснення SSOT)
- [ ] PR-4: (опційно) Автоматичний deploy IRM.view → GitHub Pages (6.3.11 альтернативний підкрок)

---

## 9) Підсумкові артефакти цього аудиту (обов’язково в PR)
- [ ] Оновлений **`AUDIT_CHECKLIST.md`** (цей файл) — заповнені розділи 3/4/5/8.
- [ ] Лист «кандидатів на видалення» з ризиками/обґрунтуванням.
- [ ] Виводи гвардів/тестів (скріни або копіпасти з консолі у PR-коментар).

---

## 10) Definition of Done (DoD)
- [ ] Створена гілка `step-6.3.12-audit`, відкритий PR.
- [ ] IRM ↔ IRM.view ↔ YAML синхронні; 6.3.9/6.3.10/6.3.11 — **done**.
- [ ] У репо немає явно «сміттєвих» файлів; `.gitignore`/`.gitattributes` актуальні.
- [ ] Усі гварди/тести **green** локально та в CI.
- [ ] Узгоджений план наступних PR для чистки/поліпшень.
- [ ] Мердж у `main` після зеленого CI.

---

## Додаток A — Ролі та майндсет
- **PM**: узгодження обсягу, пріоритизація мікрокроків, фіксація DoD.
- **Senior Dev**: технічний аудит, рішення по SSOT/генерації/хуках.
- **QA**: невидимі для продакшна зміни не повинні ламати тести/покриття.
- **DevOps**: робочість CI, відсутність flaky, чисті артефакти.
- **Repo Maintainer**: єдина стилістика комітів, чистота дерева.

---

## Додаток B — Шаблон «Знахідки → Рішення → Дія» (заповнити під час аудиту)
| ID | Знахідка | Вплив/Ризик | Рішення | Дія/PR |
|----|----------|-------------|---------|--------|
| 1  | …        | …           | …       | …      |
| 2  | …        | …           | …       | …      |

---

## Додаток C — Короткий підсумок виконаних кроків (0 → 6.3.11)
> *Цей розділ заповнюємо на основі перегляду IRM/IRM.view та історії комітів.*  
- ✅ 6.3.9 — Генерація секції з YAML → **done**  
- ✅ 6.3.10 — IRM View (read-only) + CI guard → **done**  
- ✅ 6.3.11 — Локальний pre-commit guard (IRM.view) → **done**  
- ⏳ «Ранні» кроки (0–6.3.8) — перевірити на повноту й статуси; зафіксувати «Глобальні пропуски».

---

## Порада (щоб мінімізувати дифи у YAML)
- При точкових змінах статусу в YAML — **правити вручну один рядок** у блоці `id: X.Y.Z` (без скриптів `safe_dump`), щоб уникати суцільного переформатування.

---

### Контрольний запуск перед PR
```powershell
pre-commit run -a
pytest -q
python tools/irm_phase6_gen.py --check --phase 6.3
python tools/render_irm_view.py --check

git add AUDIT_CHECKLIST.md
git commit -m "audit(6.3.12): add comprehensive audit checklist & plan"
git push -u origin step-6.3.12-audit
```
